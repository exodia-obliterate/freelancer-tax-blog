{{ $src := .Get "src" }}
{{ $alt := (.Get "alt") | default "" }}
{{ $res := resources.Get $src }}
{{ if $res }}
  {{ $widths := slice 400 800 1200 }}
  {{ $jpg := slice }}
  {{ $webp := slice }}
  {{ range $widths }}
    {{ $r := $res.Fit (printf "%dx q75" .) }}
    {{ $jpg = $jpg | append (printf "%s %dw" $r.RelPermalink .) }}
    {{ $rw := $r | resources.Convert "image/webp" }}
    {{ $webp = $webp | append (printf "%s %dw" $rw.RelPermalink .) }}
  {{ end }}
  {{ $largest := $res.Fit "1200x q75" }}
  <picture>
    <source type="image/webp" srcset="{{ delimit $webp ", " }}">
    <source type="{{ $largest.MediaType.Type }}/{{ $largest.MediaType.SubType }}" srcset="{{ delimit $jpg ", " }}">
    <img src="{{ $largest.RelPermalink }}" alt="{{ $alt }}" loading="lazy" decoding="async" width="{{ $largest.Width }}" height="{{ $largest.Height }}">
  </picture>
{{ else }}
  <img src="{{ $src | safeURL }}" alt="{{ $alt }}" loading="lazy" decoding="async">
{{ end }}
